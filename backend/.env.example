# OpenRouter
OPENROUTER_API_KEY=YOUR_OPENROUTER_API_KEY
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_HTTP_REFERER=http://localhost:3000
OPENROUTER_X_TITLE=ERR-App

# Strict model requirements
OPENROUTER_CHAT_MODEL=google/gemini-2.5-flash
# Simple tasks (translation, HyDE, QA generation) use lighter model
OPENROUTER_CHAT_MODEL_SIMPLE=google/gemini-2.5-flash-lite-preview-09-2025
# Complex tasks (multi-query expansion, LLM rerank) use more capable model
OPENROUTER_CHAT_MODEL_COMPLEX=google/gemini-2.5-flash-preview-09-2025
OPENROUTER_EMBEDDING_MODEL=qwen/qwen3-embedding-8b
OPENROUTER_EMBEDDING_DIM=4096

# ERR settings
ERR_SESSION_TTL_SECONDS=1800
ERR_SESSION_CLEANUP_INTERVAL_SECONDS=30

# Embedding query behavior (optional)
# Qwen3-Embedding is instruction-aware; enabling instructions typically improves retrieval.
ERR_EMBEDDING_QUERY_USE_INSTRUCTION=true
ERR_EMBEDDING_QUERY_INCLUDE_RAW=true
ERR_EMBEDDING_QUERY_INSTRUCTION_TEMPLATE="Instruct: {task}\nQuery:{query}"
ERR_EMBEDDING_QUERY_TASK="Given a question, retrieve relevant passages from the document that explicitly contain the answer."

# Context re-packing (ordering of retrieved chunks in the prompt)
# - reverse: put most relevant chunk near the end of CONTEXT (default)
# - forward: keep retrieval order (no re-packing)
ERR_REPACK_STRATEGY=reverse

# Recall-oriented retrieval (Multi-Query + HyDE + RRF)
ERR_QUERY_FUSION_ENABLED=true
ERR_QUERY_VARIANTS_COUNT=6
ERR_QUERY_VARIANTS_MAX=8
ERR_HYDE_ENABLED=true
ERR_HYDE_MAX_WORDS=140

# Query drift filtering (keeps recall, drops obvious off-topic variants)
ERR_DRIFT_FILTER_ENABLED=true
ERR_DRIFT_SIM_THRESHOLD=0.25
ERR_HYDE_DRIFT_SIM_THRESHOLD=0.15

# Fusion params
ERR_RRF_K=60
ERR_FUSION_PER_QUERY_TOP_K=50
ERR_FUSION_MAX_CANDIDATES=120

# LLM rerank (yes/no judge; uses ERR_LLM_RERANK_MODEL or falls back to OPENROUTER_CHAT_MODEL)
ERR_LLM_RERANK_ENABLED=true
ERR_LLM_RERANK_MODEL=
ERR_LLM_RERANK_CANDIDATE_POOL=30
ERR_LLM_RERANK_MAX_CHARS=900

# Approximate token limit guard (tune as needed)
ERR_CHAT_MODEL_CONTEXT_LIMIT_TOKENS=32768
